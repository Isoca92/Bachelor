%
% Lösungsstrategie
%
\def\bigcircle{(0:0cm) ellipse (2.0cm and 1.0cm)}
\def\bigcircletwo{(0:0cm) ellipse (2.0cm and 1.0cm)}
\def\bigcirclemove{(0:-1cm) ellipse (2.0cm and 1.0cm)}
\def\bigcirclemovetwo{(0:1cm) ellipse (2.0cm and 1.0cm)}
\def\smallcircle{(0:0.4cm) ellipse (1.5cm and 0.5cm)}
\def\smallcircletwo{(0:-0.4cm) ellipse (1.5cm and 0.5cm)}
\def\AM{(0:0cm) ellipse (2.0cm and 1.0cm)}
\def\ZM{(0:5cm) ellipse (2.0cm and 1.0cm)}

\section{Lösungsstrategie}
In dieser Arbeit wird ein Verfahren vorgestellt, das es ermöglicht zwei chemische Muster auf eine Teilmengen-Relation zu untersuchen. Dabei wird zwischen Anfrage- und Zielmuster unterschieden. Wird eine Teilmengen-Relation festgestellt, so erfolgt die Ausgabe der Lösung durch ein eindeutiges \textit{Mapping} des Anfrage- und Zielmusters. Dieses \textit{Mapping} ist eine bijektive Abbildung, die den Atomen des Anfragemusters das dazugehörige Atom des Zielmusters zuordnet.\\
Mit dieser Lösung kann herausgefunden werden, ob unterschiedlich definierte Muster dennoch Molekülmengen beschreiben, die einer Teilmengen-Relation entsprechen. Somit können, wie im Kapitel \ref{sssec:einleitung} beschrieben, zum Beispiel bei einer Beschreibung der gleichen Molekülmenge redundante Muster identifiziert werden.

Im folgenden Kapitel soll ein Überblick über die entwickelten Konzepte \cite{Master} und die Struktur der Lösung des in Kapitel \ref{sssec:einleitung} vorgestellten Problems gegeben werden.

\subsection{Konzepte} \label{ssec:konzepte}
Zum besseren Verständnis werden im Folgenden die entwickelten Konzepte des Verfahrens erläutert, die eine Untersuchung auf Teilmengen-Relationen ermöglichen.

\subsubsection{Relationen} \label{sssec:rel}
Die vorliegende Arbeit behandelt den Vergleich von chemischen Mustern anhand von Teilmengen-Relationen. Das entwickelte Verfahren kann chemische Muster auf vier Teil-\\mengen-Relationen überprüfen: Gleichheit ($=$), Untermenge ($\subseteq$), Obermenge ($\supseteq$) und Schnitt ($\cap$).
Die genaue Definition dieser Teilmengen-Relationen soll in diesem Abschnitt beschrieben werden, wobei zwischen Anfrage- ($A$) und Zielmuster ($Z$) unterschieden wird. Die Mengen von Molekülen, die durch das Anfrage- bzw. Zielmuster beschrieben werden, werden als $AM$ und $ZM$ bezeichnet und in diesem Kapitel zur Veranschaulichung als Venn-Diagramme präsentiert.\\
\begin{center}
	\begin{tikzpicture}
	\begin{scope}[fill opacity=0.3]
	\fill[green] \AM;
	\end{scope}
	\begin{scope}[fill opacity=0.3]
	\fill[cyan] \ZM;
	\end{scope}
	
	\draw \AM;
	\draw \ZM;
	
	\node[align=left] at (0,0) {$AM$};
	\node[text=black] at (5,0) {$ZM$};
	\end{tikzpicture}
\end{center}
\newpage
\subsubsection*{Gleichheit}
Wenn zwei Beschreibungen von chemischen Mustern in allen atomaren und strukturellen Eigenschaften übereinstimmen, verhalten sich die beschriebenen Molekülmengen wie im folgenden Venn-Diagramm:\\
\begin{center}
\begin{tikzpicture}
\begin{scope}[fill opacity=0.3]
\fill[green] \bigcircle;
\end{scope}
\begin{scope}[fill opacity=0.3]
\fill[cyan] \bigcircletwo;
\end{scope}

\draw \bigcircle;
\draw \bigcircletwo;

\node[text=black] at (0,0) {$AM$ und $ZM$};
\end{tikzpicture}
\end{center}
Dann gilt:\\
\begin{align*}
	A = Z
\end{align*}

\subsubsection*{Untermenge}
Wenn das Anfragemuster in seinen atomaren und strukturellen Eigenschaften im Vergleich zum Zielmuster spezifizierter oder gleich weit spezifiziert ist, verhalten sich die Molekülmengen der beiden chemischen Muster wie folgt:\\

\begin{figure}[h]
    \begin{center}
	\begin{minipage}{4.5cm}
		\begin{center}
			\begin{tikzpicture}
			\begin{scope}[fill opacity=0.3]
			\fill[green] \smallcircletwo;
			\end{scope}
			\begin{scope}[fill opacity=0.3]
			\fill[cyan] \bigcircle;
			\end{scope}
			
			\draw \smallcircletwo;
			\draw \bigcircle;
			
			\node[align=left] at (-0.4, 0) {$AM$};
			\node[text=black] at (1.5, 0) {$ZM$};
			\end{tikzpicture}
		\end{center}
	\end{minipage}
	\begin{minipage}{1cm}
		\centering
		bzw.
	\end{minipage}
	\begin{minipage}{4.5cm}
		\begin{center}
			\begin{tikzpicture}
			\begin{scope}[fill opacity=0.3]
			\fill[green] \bigcircle;
			\end{scope}
			\begin{scope}[fill opacity=0.3]
			\fill[cyan] \bigcircletwo;
			\end{scope}
			
			\draw \bigcircle;
			\draw \bigcircletwo;
			
			\node[text=black] at (0,0) {$AM$ und $ZM$};
			\end{tikzpicture}
		\end{center}
	\end{minipage}
	\end{center}
\end{figure}

Es gilt:
\begin{align*}
	A \subseteq Z
\end{align*}

\subsubsection*{Obermenge}
Wenn das Anfragemuster in seinen atomaren und strukturellen Eigenschaften im Vergleich zum Zielmuster allgemeiner oder gleich weit spezifiziert ist, verhalten sich die Molekülmengen der beiden chemischen Muster wie folgt:\\

\begin{figure}[h]
	\begin{center}
		\begin{minipage}{4.5cm}
			\begin{center}
				\begin{tikzpicture}
				\begin{scope}[fill opacity=0.3]
				\fill[green] \bigcircle;
				\end{scope}
				\begin{scope}[fill opacity=0.3]
				\fill[cyan] \smallcircle;
				\end{scope}
				
				\draw \bigcircle;
				\draw \smallcircle;
				
				\node[text=black] at (-1.5, 0) {$AM$};
				\node[align=left] at ( 0.4, 0) {$ZM$};
				\end{tikzpicture}
			\end{center}
		\end{minipage}
		\begin{minipage}{1cm}
			\centering
			bzw.
		\end{minipage}
		\begin{minipage}{4.5cm}
			\begin{center}
				\begin{tikzpicture}
				\begin{scope}[fill opacity=0.3]
				\fill[green] \bigcircle;
				\end{scope}
				\begin{scope}[fill opacity=0.3]
				\fill[cyan] \bigcircletwo;
				\end{scope}
				
				\draw \bigcircle;
				\draw \bigcircletwo;
				
				\node[text=black] at (0,0) {$AM$ und $ZM$};
				\end{tikzpicture}
			\end{center}
		\end{minipage}
	\end{center}
\end{figure}

Es gilt:
\begin{align*}
	A \supseteq Z
\end{align*}

\subsubsection*{Schnitt}
Zwei chemische Muster haben in zwei Fällen einen gemeinsamen, nicht leeren Schnitt.
Im ersten Fall besteht eine Überlappung zwischen den Mengen der logischen Alternativen des Anfrage- und Zielmusters. Im zweiten Fall besitzt das Anfragemuster Teilstrukturen, die eine Untermenge von Teilstrukturen des Zielmusters sind, sowie solche, die eine Obermenge von Teilstrukturen des Zielmusters sind.

\begin{center}
\begin{tikzpicture}
\begin{scope}[fill opacity=0.3]
\fill[green] \bigcirclemove;
\end{scope}
\begin{scope}[fill opacity=0.3]
\fill[cyan] \bigcirclemovetwo;
\end{scope}

\draw \bigcirclemove;
\draw \bigcirclemovetwo;

\node[text=black] at (-1.5, 0) {$AZ$};
\node[align=left] at (1.5, 0) {$ZM$};
\end{tikzpicture}
\end{center}

Dann gilt:
\begin{align*}
	A \cap Z
\end{align*}

\subsubsection{Valenzzustände} \label{sssec:valenz}
Um zwei chemische Muster auf die in Kapitel \ref{sssec:rel} vorgestellten Teilmengen-Relationen zu überprüfen, muss es ermöglicht werden die Menge an Eigenschaften, die Atome und Bindungen beschreiben, miteinander vergleichen zu können. Für die komplexen Atombeschreibungen muss dafür der Begriff des Valenzzustandes eingeführt werden. Allgemein versteht man unter einem Valenzzustand einen relevanten Zustand, den ein zu untersuchendes Element einnehmen kann.
Durch den anschließenden Vergleich der chemisch möglichen Valenzzustände von zwei zu untersuchenden Atomenbeschreibungen ist dann eine Untersuchung auf Teilmengen-Relationen möglich.
In der hier vorgestellten Lösung besteht die Menge der Eigenschaften, die ein Valenzzustand eines Atoms beschreiben kann, aus:
\begin{itemize}
	\setlength\itemsep{0em}\setlength\parskip{0em}
	\item Atomname
	\item Atomnummer
	\item Atomvalenz
	\item Anzahl der Einfachbindungen
	\item Anzahl der Doppelbindungen
	\item Anzahl der Dreifachbindungen
	\item Formalladung
	\item Anzahl der Bindungen zu Wasserstoffatomen
	\item ob das Atom aromatisch ist
	\item in wie vielen Ringen eines SSSR\footnote[1]{\textit{smallest set of smallest rings}} sich das Atom befindet
	\item Größe des kleinsten SSSR-Rings, in dem sich das Atom befindet
	\item Anzahl der Bindungen in Ringen
\end{itemize}
Anhand dieser Eigenschaften ist es möglich die komplexe Struktur der Atombeschreibungen eines chemischen Musters zu kategorisieren und zu analysieren.

\subsubsection{Fingerprint} \label{sssec:fprint}
Anhand der Menge von chemisch möglichen Valenzzuständen eines in chemischen Mustern vorkommenden Atoms kann ein Fingerprint generiert werden. Ein Fingerprint ist eine Repräsentation aller durch die oben beschriebenen Eigenschaften möglichen Valenzzustände. Dieser Fingerprint in Form eines Bit-Arrays (siehe Abb. \ref{abb:bitarrayatom}) gibt an, ob eine Atombeschreibung einen Valenzzustand beschreibt (Bit auf "`1"' gesetzt) oder nicht (Bit auf "`0"' gesetzt).

\begin{figure}[h]
	\centering
	\begin{tikzpicture}
	\node[draw,fill=cyan!20,minimum height=1cm,minimum width = 1cm,xshift=1cm,font=\ttfamily][label={[xshift=1cm, yshift=1.2cm,rotate=50]\footnotesize erster Valenzzustand}](N1){1};
	\draw node[below=0cm of N1]{\scriptsize 0};
	\node[draw,fill=cyan!20,minimum height=1cm,minimum width = 1cm,xshift=2cm,font=\ttfamily][label={[xshift=1.1cm, yshift=1.3cm,rotate=50]\footnotesize zweiter Valenzzustand}](N2){1};
	\draw node[below=0cm of N2]{\scriptsize 1}; 
	\node[draw,fill=green!20,minimum height=1cm,minimum width = 1cm,xshift=3cm,font=\ttfamily][label={[xshift=1.1cm, yshift=1.2cm,rotate=50]\footnotesize dritter Valenzzustand}](N3){0};
	\draw node[below=0cm of N3]{\scriptsize 2}; 
	\node[draw,fill=cyan!20,minimum height=1cm,minimum width = 1cm,xshift=4cm,font=\ttfamily][label={[xshift=1.2cm, yshift=1.2cm,rotate=50]\footnotesize vierter Valenzzustand}](N4){1};
	\draw node[below=0cm of N4]{\scriptsize 3}; 
	
	\node [tape, draw,minimum size=1cm,tape bend top=none,
	tape bend height=0.4cm,rotate=90] at (4.8,0) (t) {};
	\node [tape, draw,minimum size=1cm,tape bend top=none,
	tape bend height=0.4cm,rotate=270] at (6.8,0) (t) {};
	
	\node at (5.8,0.5) {\dots};
	\node at (5.8,-0.5) {\dots};
	
	\node[draw,fill=green!20,minimum height=1cm,minimum width = 1cm,xshift=7.6cm][label={[xshift=1.2cm, yshift=1.4cm,rotate=50]\footnotesize vorletzter Valenzzustand}](N5){0} ;
	\node[draw,fill=green!20,minimum height=1cm,minimum width = 1cm,xshift=8.6cm][label={[xshift=1.1cm, yshift=1.3cm,rotate=50]\footnotesize letzter Valenzzustand}](N6){0} ;
	\draw node[below=0cm of N5]{\scriptsize 164206}; 
	\draw node[below=0cm of N6]{\scriptsize 164207}; 
	\end{tikzpicture}
	\caption{Schematische Darstellung eines Fingerprints für eine Atombeschreibung}
	\label{abb:bitarrayatom}
\end{figure}

Der Fingerprint für den Vergleich zwischen zwei Bindungen kann ohne den Begriff der Valenzzustände erstellt werden. Benötigt wird ein Bit-Array bestehend aus fünf Bits, die die folgenden Bindungen beschreiben:
\begin{itemize}
	\setlength\itemsep{0em}\setlength\parskip{0em}
	\item[1. Bit:] Einfachbindung
	\item[2. Bit:] Doppelbindung
	\item[3. Bit:] Dreifachbindung
	\item[4. Bit:] Ringbindung
	\item[5. Bit:] Aromatische Bindung
\end{itemize}

Abbildung \ref{abb:bitarraybond} zeigt schematisch, wie dieses Bit-Array für den Fingerprint einer Bindung aufgebaut ist. Hier wird beispielsweise eine Bindung, die sowohl eine Einfach-, Doppel- oder Ringbindung beschreibt, dargestellt.

\begin{figure}[h]
	\centering
	\begin{tikzpicture}
	\node[draw,fill=cyan!20,minimum height=1cm,minimum width = 1cm,xshift=1cm,font=\ttfamily][label={[xshift=0.9cm, yshift=0.9cm,rotate=50]\footnotesize Einfachbindung}](N1){1};
	\draw node[below=0cm of N1]{\scriptsize 0};
	\node[draw,fill=cyan!20,minimum height=1cm,minimum width = 1cm,xshift=2cm,font=\ttfamily][label={[xshift=0.8cm, yshift=0.9cm,rotate=50]\footnotesize Doppelbindung}](N2){1};
	\draw node[below=0cm of N2]{\scriptsize 1}; 
	\node[draw,fill=green!20,minimum height=1cm,minimum width = 1cm,xshift=3cm,font=\ttfamily][label={[xshift=0.9cm, yshift=1cm,rotate=50]\footnotesize Dreifachbindung}](N3){0};
	\draw node[below=0cm of N3]{\scriptsize 2}; 
	\node[draw,fill=cyan!20,minimum height=1cm,minimum width = 1cm,xshift=4cm,font=\ttfamily][label={[xshift=0.8cm, yshift=0.8cm,rotate=50]\footnotesize Ringbindung}](N4){1};
	\draw node[below=0cm of N4]{\scriptsize 3}; 
	\node[draw,fill=green!20,minimum height=1cm,minimum width = 1cm,xshift=5cm,font=\ttfamily][label={[xshift=0.8cm, yshift=0.9cm,rotate=50]\footnotesize arom. Bindung}](N5){0};
	\draw node[below=0cm of N5]{\scriptsize 4};  
	\end{tikzpicture}
	\caption{Schematische Darstellung eines Fingerprints für eine Bindungsbeschreibung}
	\label{abb:bitarraybond}
\end{figure}

\newpage
\subsection{Struktur} \label{ssec:struktur}
Anhand der in Kapitel \ref{ssec:konzepte} erläuterten Konzepte ist es möglich das Verfahren zur Untersuchung auf Teilmengen-Relationen zu realisieren.
Es gliedert sich in sechs grundlegende Schritte.
Ein grober Überblick über die Struktur wird im Folgenden anhand der Abbildung \ref{abb:workflow} gegeben. Die Schritte sind in Kapitel \ref*{realisierung} detailliert beschrieben. 
 
Die Eingaben des Verfahrens beinhalten ein Anfragemuster mit Atomen (durch "`VA"' mit eindeutiger Identifikationsnummer in der Abbildung \ref{abb:workflow} beschrieben) und Bindungen (durch "`EA"' und eindeutiger Nummer beschrieben). Das Anfragemuster hat eine beliebige Größe (ausgegrauter Bereich ab Atom "`VA2"'). Das Zielmuster hat die Atom- ("`VZ"') und Bindungsbezeichnung ("`EZ"') und hat ebenfalls eine beliebige Größe. Zu den beiden Mustern wird eine der vier möglichen Teilmengen-Relationen angegeben.

Im ersten Schritt werden die Muster aufbereitet und gefiltert. Die Aufbereitung erfolgt durch die eindeutige Kennzeichnung jedes Atoms (Knoten) der Muster durch ein \textit{Label}. Anschließend wird je nach Teilmengen-Relation überprüft, ob ein Vergleich der gegebenen Muster möglich ist. Diese Überprüfung erfolgt über einen Vergleich der Knoten-Anzahl von Anfrage- und Zielmuster (siehe Abbildung \ref{abb:workflow} Schritt 1).

Der zweite Schritt wird ausgeführt, falls die Überprüfung der Muster positiv war. Ansonsten erfolgt keine Ausgabe, da keine bijektive Abbildung gefunden wurde. In ihm werden für alle Atome und Bindungen der beiden Muster Fingerprints erstellt.

Im dritten Schritt werden anhand der gegebenen Teilmengen-Relation die Fingerprints verglichen. Die Fingerprints der Knoten des Anfragemusters werden mit allen Fingerprints der Knoten des Zielmusters paarweise verglichen (in Abbildung \ref{abb:workflow} entsprechen die grünen Pfeile einer positiven Überprüfung einer Teilmengen-Relation, rote Pfeile einer negativen Überprüfung).

Entsprechen zwei Fingerprints der gegebenen Teilmengen-Relation, so wird im vierten Schritt in der Relationsmatrix der entsprechende Eintrag auf "`1"' gesetzt.

Im fünften Schritt werden die gewonnenen Matrizen an einen Algorithmus zur Untersuchung auf Subgraph-Isomorphie übergeben.

Im letzten Schritt wird das Ergebnis des gefundenen Isomorphismus in Form eines eindeutigen \textit{Mappings} gebracht und ausgegeben.

\begin{figure}[h]
	\begin{center}
	\includegraphics[width=17cm]{images/Workflow}
	\end{center}
	\caption{Schematischer Ablauf des entwickelten Verfahrens.}
	\label{abb:workflow}
\end{figure}

%
% EOF
%